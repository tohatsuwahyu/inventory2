<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>在庫管理 - ダッシュボード</title>

  <!-- Fonts & UI -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --sidebar:#0f213e; --card:#fff;
      --c1:#4f8cff; --c2:#f97316; --c3:#22c55e; --c4:#a855f7;
      --muted:#7a8499;
    }
    body{ font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue","Hiragino Sans",Meiryo,sans-serif; background:#f6f9ff; }
    .sidebar{
      width:260px; background:var(--sidebar); color:#dbe6ff; min-height:100vh; position:fixed; left:0; top:0;
      box-shadow: 8px 0 24px rgba(15,33,62,.15);
    }
    .brand{ padding:20px 18px; display:flex; gap:12px; align-items:center; }
    .brand img{ width:34px; height:34px; object-fit:contain }
    .brand small{ color:#a8b6d0 }
    .sidebar a.nav-link{ color:#cfe2ff; opacity:.92; border-radius:12px; padding:10px 14px; }
    .sidebar a.nav-link.active, .sidebar a.nav-link:hover{ background:#1c3057; color:#fff; }
    main{ margin-left:260px; padding:18px; }
    header .btn-outline-secondary{ --bs-btn-color:#334155; --bs-btn-border-color:#cbd5e1; }
    .metric{
      background:var(--card); border:none; border-radius:16px; box-shadow:0 10px 30px rgba(15,33,62,.08);
    }
    .metric .icon{
      width:44px;height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; color:#fff;
    }
    .icon-c1{ background:linear-gradient(135deg,#60a5fa,#2563eb) }
    .icon-c2{ background:linear-gradient(135deg,#fb923c,#f97316) }
    .icon-c3{ background:linear-gradient(135deg,#34d399,#16a34a) }
    .icon-c4{ background:linear-gradient(135deg,#c084fc,#a855f7) }
    .muted{ color:var(--muted) }
    /* Loading overlay */
    .loading{ position:fixed; inset:0; z-index:2000; display:flex; flex-direction:column; align-items:center; justify-content:center; background:rgba(15,22,40,.35); backdrop-filter: blur(2px); }
    .loading.d-none{ display:none }
    .loading .spinner{ width:56px; height:56px; border-radius:50%; border:6px solid #ffffff66; border-top-color:#4f8cff; animation:spin .9s linear infinite }
    .loading .text{ color:#fff; margin-top:10px; font-weight:600 }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    @media (max-width: 991px){
      .sidebar{ transform:translateX(-100%); transition:transform .25s; z-index:1050; }
      .sidebar.show{ transform:translateX(0) }
      main{ margin-left:0 }
    }
    .table-sm td,.table-sm th{ padding:.55rem .6rem }
  </style>

  <script src="config.js"></script>
</head>
<body>

<!-- SIDEBAR -->
<aside id="sb" class="sidebar">
  <div class="brand">
    <img id="brand-logo" src="./assets/tsh.png" alt="logo">
    <div>
      <div class="fw-bold">TSH 在庫管理</div>
      <small id="who">Administrator</small>
    </div>
  </div>
  <nav class="px-3">
    <a class="nav-link active" data-view="view-dashboard"><i class="bi bi-speedometer2 me-2"></i>ダッシュボード</a>
    <a class="nav-link" data-view="view-io"><i class="bi bi-arrow-left-right me-2"></i>入出庫（QR対応）</a>
    <a class="nav-link" data-view="view-stocktake"><i class="bi bi-clipboard2-data me-2"></i>棚卸</a>
    <a class="nav-link" data-view="view-items"><i class="bi bi-box-seam me-2"></i>商品一覧</a>
    <a class="nav-link" data-view="view-users"><i class="bi bi-people me-2"></i>ユーザー / QR</a>
    <a class="nav-link" data-view="view-history"><i class="bi bi-clock-history me-2"></i>履歴</a>
  </nav>
</aside>

<!-- MAIN -->
<main>
  <header class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center gap-2">
      <button id="burger" class="btn btn-outline-secondary d-lg-none"><i class="bi bi-list"></i></button>
      <h4 id="page-title" class="mb-0">ダッシュボード</h4>
    </div>
    <button id="btn-logout" class="btn btn-outline-secondary"><i class="bi bi-box-arrow-right me-1"></i> ログアウト</button>
  </header>

  <!-- ====== Dashboard ====== -->
  <section id="view-dashboard">
    <div class="row g-3 mb-3">
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card metric p-3">
          <div class="d-flex align-items-center gap-3">
            <div class="icon icon-c1"><i class="bi bi-box-seam-fill fs-5"></i></div>
            <div>
              <div class="muted small">総アイテム</div>
              <div id="metric-total-items" class="fs-4 fw-bold">—</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card metric p-3">
          <div class="d-flex align-items-center gap-3">
            <div class="icon icon-c2"><i class="bi bi-exclamation-triangle-fill fs-5"></i></div>
            <div>
              <div class="muted small">最小在庫以下</div>
              <div id="metric-low-stock" class="fs-4 fw-bold">—</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card metric p-3">
          <div class="d-flex align-items-center gap-3">
            <div class="icon icon-c3"><i class="bi bi-people-fill fs-5"></i></div>
            <div>
              <div class="muted small">ユーザー</div>
              <div id="metric-users" class="fs-4 fw-bold">—</div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card metric p-3">
          <div class="d-flex align-items-center gap-3">
            <div class="icon icon-c4"><i class="bi bi-activity fs-5"></i></div>
            <div>
              <div class="muted small">直近30日の取引</div>
              <div id="metric-txn" class="fs-4 fw-bold">—</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="row g-3">
      <div class="col-12 col-lg-8">
        <div class="card metric p-3">
          <div class="d-flex justify-content-between">
            <div class="fw-semibold">月次 IN / OUT</div>
          </div>
          <canvas id="chart-monthly" height="130"></canvas>
        </div>
      </div>
      <div class="col-12 col-lg-4">
        <div class="card metric p-3">
          <div class="d-flex justify-content-between">
            <div class="fw-semibold">今月の比率</div>
          </div>
          <canvas id="chart-pie" height="130"></canvas>
        </div>
      </div>
    </div>

    <!-- Per-item movement this month -->
    <div class="card metric p-3 mt-3">
      <div class="d-flex justify-content-between align-items-center">
        <div class="fw-semibold">今月の入出庫（商品別）</div>
        <button id="btn-export-mov" class="btn btn-sm btn-outline-secondary"><i class="bi bi-filetype-csv me-1"></i> CSVエクスポート</button>
      </div>
      <div class="table-responsive mt-2">
        <table class="table table-sm align-middle">
          <thead><tr>
            <th>コード</th><th>名称</th>
            <th class="text-end">IN</th><th class="text-end">OUT</th><th class="text-end">NET</th>
          </tr></thead>
          <tbody id="tbl-mov"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== Placeholder sections (tetap ada agar menu tidak error) ===== -->
  <section id="view-io" class="d-none"><div class="card p-3">入出庫（QR対応）ページ</div></section>
  <section id="view-stocktake" class="d-none"><div class="card p-3">棚卸ページ</div></section>
  <section id="view-items" class="d-none"><div class="card p-3">商品一覧ページ</div></section>
  <section id="view-users" class="d-none"><div class="card p-3">ユーザー / QRページ</div></section>
  <section id="view-history" class="d-none"><div class="card p-3">履歴ページ</div></section>
</main>

<!-- Loading -->
<div id="global-loading" class="loading d-none">
  <div class="spinner"></div><div id="loading-text" class="text">読み込み中…</div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="qrlib.js"></script> <!-- tetap disertakan untuk halaman lain -->
<script src="app.js"></script>

<script>
  // burger for mobile
  document.getElementById('burger')?.addEventListener('click', ()=>document.getElementById('sb').classList.toggle('show'));
</script>
</body>
</html>
